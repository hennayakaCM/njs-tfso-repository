{"version":3,"file":"filtercriteria.js","sourceRoot":"","sources":["../../../../src/repository/filter/filtercriteria.ts"],"names":[],"mappings":"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","sourcesContent":["import { IExpression, ExpressionType, ILogicalExpression, LogicalOperatorType, IMemberExpression, ILiteralExpression, IIdentifierExpression } from './../../expressions/expressionvisitor';\n\nexport interface IFilterCriteria {\n    property: string\n    operator: string\n    value: any\n\n    isValid: boolean\n}\n\nexport class FilterCriteria implements IFilterCriteria {\n    private _expression: ILogicalExpression;\n\n    constructor(expression: ILogicalExpression) {\n        this._expression = expression;\n    }\n\n    protected get expression() {\n        return this._expression;\n    }\n\n    public get property() {\n        switch (this._expression.left.type) {\n            case ExpressionType.Member:\n                return (<IIdentifierExpression>(<IMemberExpression>this._expression.left).property).name;\n\n            case ExpressionType.Literal:\n\n                switch (this._expression.right.type) {\n                    case ExpressionType.Member:\n                        return (<IIdentifierExpression>(<IMemberExpression>this._expression.right).property).name;\n\n                    default:\n                        return \"\";\n\n                }\n\n            default:\n                return \"\";\n        }\n    }\n\n    public get operator() {\n        switch (this._expression.left.type) {\n            case ExpressionType.Member:\n                switch (this._expression.operator) {\n                    case LogicalOperatorType.Equal:\n                        return \"==\";\n\n                    case LogicalOperatorType.NotEqual:\n                        return \"!=\";\n\n                    case LogicalOperatorType.Greater:\n                        return \">\";\n\n                    case LogicalOperatorType.GreaterOrEqual:\n                        return \">=\";\n\n                    case LogicalOperatorType.Lesser:\n                        return \"<\";\n\n                    case LogicalOperatorType.LesserOrEqual:\n                        return \"<=\";\n                }\n\n                return null;\n\n            case ExpressionType.Literal:\n                switch (this._expression.operator) {\n                    case LogicalOperatorType.Equal:\n                        return \"==\";\n\n                    case LogicalOperatorType.NotEqual:\n                        return \"!=\";\n\n                    case LogicalOperatorType.Greater:\n                        return \"<\";\n\n                    case LogicalOperatorType.GreaterOrEqual:\n                        return \"<=\";\n\n                    case LogicalOperatorType.Lesser:\n                        return \">\";\n\n                    case LogicalOperatorType.LesserOrEqual:\n                        return \">=\";\n                }\n\n                break;\n\n            default:\n                return null;\n        }\n    }\n\n    public get value() {\n        switch (this._expression.left.type) {\n            case ExpressionType.Literal:\n                return (<ILiteralExpression>this._expression.left).value;\n\n            case ExpressionType.Member:\n\n                switch (this._expression.right.type) {\n                    case ExpressionType.Literal:\n                        return (<ILiteralExpression>this._expression.right).value;\n\n                    default:\n                        return null;\n                }\n\n            default:\n                return null;\n        }\n    }\n\n    public get isValid() {\n        // requires \"member.property [comparison operator] literal\" for now\n\n        switch (this._expression.left.type) {\n            case ExpressionType.Member:\n\n                if ((<IMemberExpression>this._expression.left).object.type == ExpressionType.Identifier && (<IMemberExpression>this._expression.left).property.type == ExpressionType.Identifier) {\n\n                    switch (this._expression.right.type) {\n                        case ExpressionType.Literal:\n                            return true;\n\n                        default:\n                            return false;\n                    }\n\n                } else {\n                    return false;\n                }\n\n            case ExpressionType.Literal:\n\n                switch (this._expression.right.type) {\n                    case ExpressionType.Member:\n                        if ((<IMemberExpression>this._expression.right).object.type == ExpressionType.Identifier && (<IMemberExpression>this._expression.right).property.type == ExpressionType.Identifier)\n                            return true;\n                        else\n                            return false;\n\n                    default:\n                        return false;\n                }\n\n            default:\n                return false;\n        }\n    }\n\n    public static visit(expression: ILogicalExpression): Array<IFilterCriteria> {\n        var result: Array<IFilterCriteria> = [];\n\n        if (expression.operator == LogicalOperatorType.Or)\n            return result;\n\n        switch (expression.operator) {\n            case LogicalOperatorType.Or:\n\n                break;\n\n            case LogicalOperatorType.And:\n                if (expression.left.type == ExpressionType.Logical)\n                    result = result.concat(FilterCriteria.visit(<ILogicalExpression>expression.left));\n\n                if (expression.right.type == ExpressionType.Logical)\n                    result = result.concat(FilterCriteria.visit(<ILogicalExpression>expression.right));\n\n                break;\n\n            default:\n                result.push(new FilterCriteria(expression));\n                break;\n        }\n\n        return result.filter((criteria) => criteria.isValid);\n    }\n\n}"]}