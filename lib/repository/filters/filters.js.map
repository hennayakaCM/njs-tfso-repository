{"version":3,"file":"filters.js","sourceRoot":"","sources":["../../../src/repository/filters/filters.ts"],"names":[],"mappings":";AAAA,uBAAgC,UAAU,CAAC,CAAA;AAG3C,iCAAiC,sCAAsC,CAAC,CAAA;AACxE,+BAA+E,oCAAoC,CAAC,CAAA;AASpH;IAGI,iBAAY,SAAmC;QAAE,oBAAoB;aAApB,WAAoB,CAApB,sBAAoB,CAApB,IAAoB;YAApB,mCAAoB;;QAF7D,YAAO,GAAmB,EAAE,CAAC;QAIjC,IAAI,MAAM,GAAG,IAAI,mCAAgB,CAAC,SAAS,CAAC,EACxC,OAAO,GAAG,IAAI,+BAAc,EAAE,CAAC;QAEnC,IAAI,UAAU,GAAG,OAAO,CAAC,WAAW,OAAnB,OAAO,GAAa,SAAS,SAAK,UAAU,EAAC,CAAC;QAE/D,EAAE,CAAC,CAAC,OAAO,CAAC,UAAU,IAAI,IAAI,CAAC,CAAC,CAAC;YAC7B,EAAE,CAAC,CAAC,UAAU,IAAI,IAAI,IAAI,UAAU,CAAC,IAAI,IAAI,+BAAc,CAAC,OAAO,CAAC;gBAChE,IAAI,CAAC,OAAO,GAAG,eAAM,CAAC,KAAK,CAAqB,UAAU,CAAC,CAAC;QACpE,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,MAAM,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC;QACjD,CAAC;IACL,CAAC;IAED,sBAAW,2BAAM;aAAjB;YACI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;QACxB,CAAC;;;OAAA;IAEM,0BAAQ,GAAf;QACI,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,CAAC,CAAC;YACzB,MAAM,CAAC,IAAI,KAAK,EAAmB,CAAC;QAExC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,UAAC,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG;YACvC,MAAM,CAAC,IAAI,eAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;QACvD,CAAC,CAAC,CAAC,QAAQ,CAAC;IAChB,CAAC;IAEM,iCAAe,GAAtB;QACI,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,IAAI,CAAC,CAAC;YACxB,MAAM,CAAC,IAAI,KAAK,EAAmB,CAAC;QAExC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,UAAC,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG;YACvC,IAAI,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,UAAC,QAAQ;gBACxC,GAAG,CAAC,CAAa,UAAU,EAAV,KAAA,CAAC,CAAC,QAAQ,EAAV,cAAU,EAAV,IAAU,CAAC;oBAAvB,IAAI,IAAI,SAAA;oBACT,EAAE,CAAC,CAAC,QAAQ,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,IAAI,QAAQ,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,IAAI,QAAQ,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC;wBAAC,MAAM,CAAC,IAAI,CAAC;iBAAA;gBAE9H,MAAM,CAAC,KAAK,CAAC;YACjB,CAAC,CAAC,CAAA;YAEF,MAAM,CAAC,IAAI,eAAM,CAAC,QAAQ,CAAC,CAAC;QAChC,CAAC,CAAC,CAAC,QAAQ,CAAA;IACf,CAAC;IACL,cAAC;AAAD,CAAC,AA9CD,IA8CC;AA9CY,eAAO,UA8CnB,CAAA","sourcesContent":["import { IFilter, Filter } from './filter';\r\nimport { IFilterCriteria, FilterCriteria } from './filtercriteria';\r\n\r\nimport { LambdaExpression } from './../../expressions/lambdaexpression';\r\nimport { ReducerVisitor, Expression, ExpressionType, ILogicalExpression } from './../../expressions/reducervisitor';\r\n\r\nexport interface IFilters {\r\n    groups: Array<IFilter>\r\n\r\n    getUnion(): Array<IFilterCriteria>\r\n    getIntersection(): Array<IFilterCriteria>\r\n}\r\n\r\nexport class Filters<TEntity> implements IFilters {\r\n    private _groups: Array<IFilter> = [];\r\n\r\n    constructor(predicate: (it: TEntity) => boolean, ...parameters: any[]) {\r\n\r\n        var lambda = new LambdaExpression(predicate),\r\n            visitor = new ReducerVisitor();\r\n\r\n        var expression = visitor.visitLambda(predicate, ...parameters);\r\n\r\n        if (visitor.isSolvable == true) {\r\n            if (expression != null && expression.type == ExpressionType.Logical)\r\n                this._groups = Filter.visit(<ILogicalExpression>expression);\r\n        } else {\r\n            throw new Error('Predicate is not solvable');\r\n        }\r\n    }\r\n\r\n    public get groups() {\r\n        return this._groups;\r\n    }\r\n\r\n    public getUnion() {\r\n        if (this._groups.length == 0)\r\n            return new Array<IFilterCriteria>();\r\n\r\n        return this.groups.reduce((res, v, idx, arr) => {\r\n            return new Filter(res.criteria.concat(v.criteria));\r\n        }).criteria;\r\n    }\r\n\r\n    public getIntersection() {\r\n        if (this.groups.length == 0)\r\n            return new Array<IFilterCriteria>();\r\n\r\n        return this.groups.reduce((res, v, idx, arr) => {\r\n            var criteria = res.criteria.filter((criteria) => {\r\n                for (let crit of v.criteria)\r\n                    if (criteria.property == crit.property && criteria.operator == crit.operator && criteria.value == crit.value) return true;\r\n\r\n                return false;\r\n            })\r\n\r\n            return new Filter(criteria);\r\n        }).criteria\r\n    }\r\n}"]}